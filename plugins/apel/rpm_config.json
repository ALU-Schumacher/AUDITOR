{
    "extensions": {
        "enabled": [
            "blocks",
            "python_venv",
            "file_extras",
            "file_permissions"
        ]
    },
    "core": {
        "license": "BSD-2-Clause-Patent",
        "name": "auditor_apel_plugin",
        "summary": "AUDITOR plugin for sending accounting data to APEL",
        "version": "0.9.4"
    },
    "python_venv": {
        "name": "venv",
        "path": "/opt/auditor_apel_plugin",
        "require_setup_py": false
    },
    "blocks": {
        "pre": [
            "%define _build_id_links none",
            "if [ \"$1\" -eq 1 ]; then",
            "  getent group auditor || groupadd --system auditor",
            "  getent passwd auditor-apel-plugin || useradd --system --no-create-home --gid auditor --shell /sbin/nologin auditor-apel-plugin",
            "fi"
        ],
        "post": [
            "if [ \"$1\" -eq 1 ]; then",
            "  systemctl --no-reload preset auditor_apel_plugin",
            "fi",
            "if [ \"$1\" -eq 2 ]; then",
            "  systemctl set-property auditor_apel_plugin Markers=+needs-restart",
            "fi"
        ],
        "preun": [
            "if [ \"$1\" -eq 0 ]; then",
            "  systemctl --no-reload disable --now --no-warn auditor_apel_plugin",
            "fi"
        ],
        "postun": [
            "if [ \"$1\" -eq 0 ]; then",
            "  runuser -u auditor-apel-plugin -- rm /var/lib/auditor_apel_plugin/*",
            "  rmdir /var/lib/auditor_apel_plugin/ || true",
            "  rmdir /etc/auditor/ || true",
            "  rmdir /opt/auditor_apel_plugin || true",
            "  userdel auditor-apel-plugin",
            "  groupdel auditor || true",
            "fi"
        ],
        "install": "install -d -D -m 0750 %{buildroot}/var/lib/auditor_apel_plugin",
        "files": "%dir %attr(0750 auditor-apel-plugin auditor) /var/lib/auditor_apel_plugin",
        "desc": "AUDITOR plugin for sending accounting data to APEL",
        "changelog": [
            "* Fri May 23 2025 Dirk Sammel <dirk.sammel@physik.uni-freiburg.de> - 0.9.4\n- Release v0.9.4 - see https://github.com/ALU-Schumacher/AUDITOR/blob/main/CHANGELOG.md for changes",
            "* Wed May 14 2025 Dirk Sammel <dirk.sammel@physik.uni-freiburg.de> - 0.9.3\n- Release v0.9.3 - see https://github.com/ALU-Schumacher/AUDITOR/blob/main/CHANGELOG.md for changes",
            "* Thu Apr 10 2025 Raghuvar Vijayakumar <raghuvar.vijayakumar@physik.uni-freiburg.de> - 0.9.2\n- Release v0.9.2 - see https://github.com/ALU-Schumacher/AUDITOR/blob/main/CHANGELOG.md for changes",
            "* Mon Mar 31 2025 Raghuvar Vijayakumar <raghuvar.vijayakumar@physik.uni-freiburg.de> - 0.9.1\n- Release v0.9.1 - see https://github.com/ALU-Schumacher/AUDITOR/blob/main/CHANGELOG.md for changes",
            "* Thu Mar 27 2025 Raghuvar Vijayakumar <raghuvar.vijayakumar@physik.uni-freiburg.de> - 0.9.0\n- Release v0.9.0 - see https://github.com/ALU-Schumacher/AUDITOR/blob/main/CHANGELOG.md for changes",
            "* Mon Mar 03 2025 Dirk Sammel <dirk.sammel@physik.uni-freiburg.de> - 0.8.0\n - First version in a package"
        ]
    },
    "file_permissions": {
        "user": "root",
        "group": "root"
    },
    "file_extras": {
        "files": [
            {
                "src": "unit_files/auditor_apel_plugin.service",
                "dest": "/usr/lib/systemd/system/auditor_apel_plugin.service"
            },
            {
                "src": "configs/auditor_apel_plugin_template.yml",
                "dest": "/etc/auditor/auditor_apel_plugin.yml",
                "config": "noreplace"
            }
        ]
    }
}
